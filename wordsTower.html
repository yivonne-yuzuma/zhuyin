<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›¸ä¼¼å­—çˆ¬å¡”å¤§å†’éšª</title>
    <style>
        :root { --primary: #4a90e2; --success: #2ecc71; --error: #e74c3c; --gold: #f1c40f; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: #2c3e50; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; color: white; }
        .game-container { background: #34495e; width: 95%; max-width: 500px; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); position: relative; }
        
        /* é ‚éƒ¨è³‡è¨Šæ¬„ */
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .hp-bar { color: var(--error); font-size: 1.5rem; }
        .stage-info { background: rgba(0,0,0,0.3); padding: 5px 15px; border-radius: 20px; }

        /* é€²åº¦æ¢ */
        .progress-wrapper { width: 100%; height: 10px; background: #2c3e50; border-radius: 5px; margin-bottom: 30px; position: relative; }
        .progress-fill { height: 100%; background: var(--success); width: 0%; border-radius: 5px; transition: 0.3s; }
        .character { position: absolute; top: -25px; left: 0%; transition: 0.3s; font-size: 20px; }

        /* é¡Œç›®å€ */
        .quiz-box { background: white; color: #333; height: 150px; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: bold; margin-bottom: 25px; box-shadow: inset 0 0 10px rgba(0,0,0,0.1); padding: 0 15px; text-align: center; }
        
        /* æŒ‰éˆ•å€ */
        .options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .btn { background: var(--primary); border: none; padding: 20px 10px; color: white; font-size: 1.5rem; border-radius: 12px; cursor: pointer; transition: 0.1s; box-shadow: 0 5px 0 #2980b9; }
        .btn:active { transform: translateY(3px); box-shadow: none; }
        .btn.wrong { background: var(--error); box-shadow: 0 5px 0 #c0392b; }

        /* å½ˆçª— */
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); border-radius: 20px; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .overlay h2 { font-size: 2.5rem; margin-bottom: 10px; }
        .msg { font-size: 1.2rem; margin-bottom: 20px; color: #bdc3c7; }
    </style>
</head>
<body>

<div class="game-container">
    <div class="top-bar">
        <div class="stage-info">é—œå¡ <span id="lv-num">1</span></div>
        <div class="hp-bar" id="hp-display">â¤ï¸â¤ï¸â¤ï¸</div>
        <div id="score-display">âœ¨ 0</div>
    </div>

    <div class="progress-wrapper">
        <div class="character" id="char">ğŸƒ</div>
        <div class="progress-fill" id="prog"></div>
    </div>

    <div class="quiz-box" id="q-text">åŠ è¼‰ä¸­...</div>

    <div class="options">
        <button class="btn" onclick="guess(0)" id="opt0">-</button>
        <button class="btn" onclick="guess(1)" id="opt1">-</button>
        <button class="btn" onclick="guess(2)" id="opt2">-</button>
    </div>

    <div class="overlay" id="screen">
        <h2 id="screen-title">æŒ‘æˆ°é–‹å§‹</h2>
        <p class="msg" id="screen-msg">ç›®æ¨™ï¼šé€£çºŒé€šéå…©å€‹éšæ®µ</p>
        <button class="btn" style="width:200px" onclick="startStage()" id="screen-btn">å‡ºç™¼ï¼</button>
    </div>
</div>

<script>
    let allData = [];
    let stagePool = [];
    let currentLv = 1;
    let hp = 3;
    let score = 0;
    let progress = 0;
    const goal = 10; // æ¯é—œ 10 é¡Œ
    let currentQ = null;

    async function init() {
        try {
            const res = await fetch('quiz.json');
            allData = await res.json();
            showOverlay("åº·è»’å››ä¸Šå¤§å†’éšª", "æº–å‚™å¥½æŒ‘æˆ° L7-L12 çš„ç›¸ä¼¼å­—äº†å—ï¼Ÿ");
        } catch (e) { document.getElementById('q-text').innerText = "è®€å–é¡Œåº«å¤±æ•—"; }
    }

    function showOverlay(title, msg, btnText = "é–‹å§‹æŒ‘æˆ°") {
        const screen = document.getElementById('screen');
        document.getElementById('screen-title').innerText = title;
        document.getElementById('screen-msg').innerText = msg;
        document.getElementById('screen-btn').innerText = btnText;
        screen.style.display = 'flex';
    }

    function startStage() {
        document.getElementById('screen').style.display = 'none';
        hp = 3; progress = 0;
        updateUI();
        stagePool = allData.filter(d => d.level === currentLv);
        nextQ();
    }

    function nextQ() {
        currentQ = stagePool[Math.floor(Math.random() * stagePool.length)];
        document.getElementById('q-text').innerText = currentQ.q;
        document.getElementById('q-text').style.color = "#333";
        
        let opts = [...currentQ.options].sort(() => Math.random() - 0.5);
        for(let i=0; i<3; i++) {
            const btn = document.getElementById(`opt${i}`);
            btn.innerText = opts[i] || "";
            btn.className = "btn"; // é‡ç½®é¡è‰²
        }
    }

    function guess(idx) {
        const btn = document.getElementById(`opt${idx}`);
        if(btn.innerText === currentQ.ans) {
            score += 10;
            progress++;
            updateUI();
            if(progress >= goal) {
                winStage();
            } else {
                nextQ();
            }
        } else {
            hp--;
            btn.classList.add('wrong');
            document.getElementById('q-text').innerText = `ç­”æ¡ˆæ˜¯ã€Œ${currentQ.ans}ã€`;
            document.getElementById('q-text').style.color = "var(--error)";
            updateUI();
            if(hp <= 0) {
                showOverlay("æŒ‘æˆ°å¤±æ•—", "åˆ¥æ°£é¤’ï¼Œå†ç·´ç¿’ä¸€æ¬¡å§ï¼", "é‡æ–°é–‹å§‹");
            } else {
                setTimeout(nextQ, 1000);
            }
        }
    }

    function updateUI() {
        document.getElementById('hp-display').innerText = "â¤ï¸".repeat(hp);
        document.getElementById('score-display').innerText = `âœ¨ ${score}`;
        document.getElementById('lv-num').innerText = currentLv;
        const percent = (progress / goal) * 100;
        document.getElementById('prog').style.width = percent + "%";
        document.getElementById('char').style.left = `calc(${percent}% - 10px)`;
    }

    function winStage() {
        if(currentLv === 1) {
            currentLv = 2;
            showOverlay("ç¬¬ä¸€é—œé”æˆï¼", "å¤ªå²å®³äº†ï¼æº–å‚™å¥½é€²å…¥ L10-L12 äº†å—ï¼Ÿ", "é€²å…¥ç¬¬äºŒé—œ");
        } else {
            showOverlay("å…¨æ•¸é€šé—œï¼", `å¤ªå¼·äº†ï¼ç¸½å¾—åˆ†ï¼š${score}`, "å†æ¬¡æŒ‘æˆ°");
            currentLv = 1; score = 0;
        }
    }

    init();
</script>
</body>
</html>