<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é£›é¾å¤§æ¢éšª-ç°¡æ˜“ç‰ˆ</title>
    <style>
        :root { --primary: #3498db; --success: #2ecc71; --error: #e74c3c; }
        body { margin: 0; padding: 0; overflow: hidden; font-family: "Microsoft JhengHei", sans-serif; background: #87CEEB; touch-action: none; }
        
        #game-container { position: relative; width: 100vw; height: 100vh; overflow: hidden; }

        /* ä¸‰æ¢è»Œé“ç·š (è¼”åŠ©è¦–è¦º) */
        .lane { position: absolute; width: 100%; height: 2px; background: rgba(255,255,255,0.3); left: 0; }

        /* é£›é¾ï¼šæ”¹ç‚ºå¹³æ»‘åˆ‡æ›ä½ç½® */
        #dragon {
            position: absolute;
            left: 10%;
            font-size: 60px;
            z-index: 10;
            transition: top 0.2s ease-out; /* å¿«é€Ÿä¸”å¹³æ»‘çš„åˆ‡æ› */
            user-select: none;
        }

        /* ç­”æ¡ˆçƒï¼šè®Šå¤§æ›´å¥½æ’ */
        .bubble {
            position: absolute;
            width: 100px;
            height: 100px;
            background: white;
            border: 5px solid var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* UI å±¤ */
        .stats { position: absolute; top: 10px; left: 10px; font-size: 22px; font-weight: bold; z-index: 30; background: rgba(255,255,255,0.7); padding: 5px 15px; border-radius: 10px; }
        
        #quiz-bar {
            position: absolute;
            top: 70px; left: 50%; transform: translateX(-50%);
            background: white; padding: 10px 30px; border-radius: 30px;
            font-size: 36px; font-weight: bold; border: 4px solid var(--primary);
            z-index: 30; width: 80%; text-align: center;
        }

        #instruction {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.6); color: white; padding: 10px 20px;
            border-radius: 10px; font-size: 18px; text-align: center; z-index: 30;
        }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 100; color: white;
        }
        .btn { background: var(--success); border: none; padding: 20px 50px; color: white; font-size: 28px; border-radius: 50px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="game-container">
        <div class="stats">â¤ï¸ <span id="hp">3</span> | ğŸ† <span id="score">0</span></div>
        <div id="quiz-bar">è¼‰å…¥ä¸­...</div>
        <div id="dragon">ğŸ‰</div>
        <div id="instruction">é»æ“Šè¢å¹•ã€ä¸ŠåŠéƒ¨ã€‘å‘ä¸Šç§»ï¼Œã€ä¸‹åŠéƒ¨ã€‘å‘ä¸‹ç§»</div>
    </div>

    <div id="menu" class="overlay">
        <h1>ğŸ‰ é£›é¾å¤§æ¢éšª (ç°¡æ˜“ç‰ˆ)</h1>
        <p>æ§åˆ¶é£›é¾ä¸Šä¸‹ç§»å‹•ï¼Œåƒæ‰æ­£ç¢ºç­”æ¡ˆï¼</p>
        <button class="btn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
    </div>

    <script>
        let allData = [];
        let currentQ = null;
        let hp = 3;
        let score = 0;
        let currentLane = 1; // 0:ä¸Š, 1:ä¸­, 2:ä¸‹
        const laneY = [25, 50, 75]; // é«˜åº¦ç™¾åˆ†æ¯”
        let bubbles = [];
        let gameActive = false;

        async function init() {
            try {
                const res = await fetch('quiz.json');
                allData = await res.json();
            } catch (e) { alert("è®€å–é¡Œåº«å¤±æ•—"); }
        }

        function startGame() {
            document.getElementById('menu').style.display = 'none';
            hp = 3; score = 0; updateUI();
            moveDragon();
            gameActive = true;
            spawnQuiz();
            requestAnimationFrame(gameLoop);
        }

        // ç°¡åŒ–æ“ä½œï¼šé»æ“Šä¸Šä¸‹æ±ºå®šè»Œé“
        window.addEventListener('mousedown', (e) => {
            if (!gameActive) return;
            if (e.clientY < window.innerHeight / 2) {
                if (currentLane > 0) currentLane--;
            } else {
                if (currentLane < 2) currentLane++;
            }
            moveDragon();
        });

        // æ”¯æ´è§¸æ§
        window.addEventListener('touchstart', (e) => {
            if (!gameActive) return;
            let touchY = e.touches[0].clientY;
            if (touchY < window.innerHeight / 2) {
                if (currentLane > 0) currentLane--;
            } else {
                if (currentLane < 2) currentLane++;
            }
            moveDragon();
            e.preventDefault();
        }, {passive: false});

        function moveDragon() {
            const dragon = document.getElementById('dragon');
            dragon.style.top = `calc(${laneY[currentLane]}% - 30px)`;
        }

        function spawnQuiz() {
            currentQ = allData[Math.floor(Math.random() * allData.length)];
            document.getElementById('quiz-bar').innerText = currentQ.q;
            
            const shuffledOptions = [...currentQ.options].sort(() => Math.random() - 0.5);
            shuffledOptions.forEach((text, i) => {
                const b = document.createElement('div');
                b.className = 'bubble';
                b.innerText = text;
                b.style.left = '110vw';
                b.style.top = `calc(${laneY[i]}% - 50px)`;
                document.getElementById('game-container').appendChild(b);
                bubbles.push({ el: b, x: window.innerWidth * 1.1, lane: i, text: text });
            });
        }

        function gameLoop() {
            if (!gameActive) return;

            for (let i = bubbles.length - 1; i >= 0; i--) {
                let b = bubbles[i];
                b.x -= 5 + (score * 0.2); // é€Ÿåº¦éš¨åˆ†æ•¸å¢åŠ 
                b.el.style.left = b.x + 'px';

                // ç¢°æ’æª¢æŸ¥ (ç•¶çƒç¶“éé£›é¾æ‰€åœ¨ä½ç½®)
                if (b.x < window.innerWidth * 0.18 && b.x > window.innerWidth * 0.05) {
                    if (b.lane === currentLane) {
                        checkAnswer(b.text);
                        clearBubbles();
                        spawnQuiz();
                        break;
                    }
                }

                // æ²’åƒåˆ°çƒé£›å‡ºè¢å¹•
                if (b.x < -120) {
                    clearBubbles();
                    spawnQuiz();
                    break;
                }
            }
            requestAnimationFrame(gameLoop);
        }

        function checkAnswer(ans) {
            if (ans === currentQ.ans) {
                score++;
            } else {
                hp--;
                flashScreen();
            }
            updateUI();
            if (hp <= 0) gameOver();
        }

        function flashScreen() {
            document.body.style.background = "#ff6666";
            setTimeout(() => { document.body.style.background = "#87CEEB"; }, 200);
        }

        function clearBubbles() {
            bubbles.forEach(b => b.el.remove());
            bubbles = [];
        }

        function updateUI() {
            document.getElementById('hp').innerText = hp;
            document.getElementById('score').innerText = score;
        }

        function gameOver() {
            gameActive = false;
            document.getElementById('menu').style.display = 'flex';
            document.getElementById('menu').innerHTML = `<h1>æŒ‘æˆ°çµæŸ</h1><p>ç²å¾—åˆ†æ•¸ï¼š${score}</p><button class="btn" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>`;
        }

        init();
    </script>
</body>
</html>